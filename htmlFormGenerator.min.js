function FormRenderer(t){var i=htmlCanvas.widget();return i.renderOn=function(i){for(var e=0;e<t.fields.length;e++)t.fields[e],Field,t.fields[e].renderOn(i);buttons=i.div().addClass("buttons"),i.button("Save").click(function(){t.save()}).addClass("save").asJQuery().appendTo(buttons.asJQuery())},i}function InputRenderer(t,i){var e=htmlCanvas.widget();return e.renderOn=function(e){label=e.span(t.label).addClass("label"),t.isRequired&&label.addClass("required"),input=e.input(),void 0!==i&&input.setAttribute("type",i),input.change(function(){t.form.proxy[t.attribute]=jQuery(this).val()}),input.keyup(function(i){13==i.keyCode?t.form.save():t.form.proxy[t.attribute]=jQuery(this).val()}),input.setAttribute("value",t.form.proxy[t.attribute])},e}function TextareaRenderer(t){var i=htmlCanvas.widget();return i.renderOn=function(i){label=i.span(t.label).addClass("label"),t.isRequired&&label.addClass("required"),textarea=i.textarea().change(function(i){t.form.proxy[t.attribute]=jQuery(this).val()}),textarea.asJQuery().val(t.form.proxy[t.attribute])},i}function CheckboxRenderer(t){var i=htmlCanvas.widget();function e(i){array=t.form.proxy[t.attribute],value=i.attr("data-submit"),index=array.indexOf(value),i.is(":checked")?-1==index&&array.push(value):-1!=index&&array.splice(index,1)}return i.renderOn=function(i){label=i.span(t.label).addClass("label"),t.isRequired&&label.addClass("required"),div=i.div().addClass("checkbox-container");for(var n=0;n<t.options.length;n++)checkbox=i.input().setAttribute("type","checkbox").setAttribute("data-submit",t.options[n]),checkbox.asJQuery().appendTo(div.asJQuery()),checkbox.click(function(){e($(this))}),-1!=t.form.proxy[t.attribute].indexOf(t.options[n])&&checkbox.setAttribute("checked","checked"),i.span(t.options[n]).addClass("option").asJQuery().appendTo(div.asJQuery()),1==t.columnNumber?i.br().asJQuery().appendTo(div.asJQuery()):n>0&&(n+1)%t.columnNumber==0&&i.br().asJQuery().appendTo(div.asJQuery())},i}function RadioRenderer(t){var i=htmlCanvas.widget();return i.renderOn=function(i){label=i.span(t.label).addClass("label"),t.isRequired&&label.addClass("required"),div=i.div().addClass("radio-container");for(var e=0;e<t.options.length;e++)radio=i.input().setAttribute("type","radio").setAttribute("data-submit",t.options[e]),radio.setAttribute("name",t.attribute),radio.asJQuery().appendTo(div.asJQuery()),radio.click(function(){var i;i=$(this),t.form.proxy[t.attribute]=i.attr("data-submit")}),t.form.proxy[t.attribute]==t.options[e]&&radio.setAttribute("checked","checked"),i.span(t.options[e]).addClass("option").asJQuery().appendTo(div.asJQuery()),1==t.columnNumber?i.br().asJQuery().appendTo(div.asJQuery()):e>0&&(e+1)%t.columnNumber==0&&i.br().asJQuery().appendTo(div.asJQuery())},i}function SelectRenderer(t){var i=htmlCanvas.widget();return i.renderOn=function(i){label=i.span(t.label).addClass("label"),t.isRequired&&label.addClass("required"),select=i.select();for(var e=0;e<t.options.length;e++)option=i.option(t.options[e]).setAttribute("value",t.options[e]),t.form.proxy[t.attribute]==t.options[e]&&option.setAttribute("selected",!0),option.asJQuery().appendTo(select.asJQuery());select.asJQuery().change(function(){var i;i=$(this),t.form.proxy[t.attribute]=i.val()})},i}function Comment(t){var i=htmlCanvas.widget();return i.renderOn=function(i){i.span(t).addClass("comment")},i}Form=function(anObject){this.fields=[],this.object=anObject,this.proxy=jQuery.extend({},this.object),this.saveAction,this.add=function(t){t instanceof Field&&(t.form=this),this.fields.push(t)},this.renderOn=function(t){FormRenderer(this).appendTo(t.div().addClass("form").asJQuery())},this.isValidated=function(){return!0},this.save=function(){$(".error").remove();for(var allFieldsAreValidated=!0,i=0;i<this.fields.length;i++)object=this.fields[i],object instanceof Field&&!object.isValidated()&&(allFieldsAreValidated=!1);if(allFieldsAreValidated){if(this.isValidated())return f=this.saveAction.toString().split("{"),f=f[1].split("}")[0],closure=new Function("val","return "+f+";"),closure(eval(this.proxy));console.log("can not save...")}},this.onSave=function(t){this.saveAction=t},this.onCancel=function(t){this.cancelAction=t}},Field=function(){this.form,this.attribute,this.label="",this.fieldContainer,this.conditions,this.isRequired,this.cssClass,this.init=function(t,i){this.conditions=[],this.cssClass="field",this.attribute=t,this.label=i,this.isRequired=!1},this.label=function(t){this.label=t},this.required=function(t){this.isRequired=!0,this.addCondition(new NotEmptyCondition(t))},this.addCondition=function(t,i){condition=[],condition.push(t),condition.push(i),this.conditions.push(condition)},this.addClass=function(t){this.cssClass+=" "+t},this.checkCondition=function(object){return f=object[0],f instanceof Condition&&(f=f.closure),f=f.toString(),f=f.slice(f.indexOf("{")+1,f.lastIndexOf("}")),closure=new Function("val",f),closure(eval("this.form.proxy."+this.attribute))},this.isValidated=function(){for(var t=0;t<this.conditions.length;t++)if(condition=this.conditions[t],!this.checkCondition(condition))return condition[0]instanceof Condition?Error(condition[0].label).appendTo(this.fieldContainer):Error(condition[1]).appendTo(this.fieldContainer),!1;return!0}},FieldList=function(){this.conditions=[],this.setOptions=function(t){this.options=t},this.setColumnNumber=function(t){this.columnNumber=t},this.init=function(t,i){this.options=[],this.columnNumber=1,this.attribute=t,this.label=i}},FieldList.prototype=new Field,Input=function(t,i,e){this.init(t,i),this.renderOn=function(t){this.fieldContainer=t.div().addClass(this.cssClass).asJQuery(),InputRenderer(this,e).appendTo(this.fieldContainer)}},Input.prototype=new Field,Password=function(t,i){this.init(t,i),this.renderOn=function(t){this.fieldContainer=t.div().addClass(this.cssClass).asJQuery(),InputRenderer(this,"password").appendTo(this.fieldContainer)}},Password.prototype=new Field,Textarea=function(t,i){this.init(t,i),this.renderOn=function(t){this.fieldContainer=t.div().addClass(this.cssClass).asJQuery(),TextareaRenderer(this).appendTo(this.fieldContainer)}},Textarea.prototype=new Field,Checkbox=function(t,i){this.init(t,i),this.renderOn=function(t){this.fieldContainer=t.div().addClass(this.cssClass).asJQuery(),CheckboxRenderer(this).appendTo(this.fieldContainer)}},Checkbox.prototype=new FieldList,Radio=function(t,i){this.init(t,i),this.renderOn=function(t){this.fieldContainer=t.div().addClass(this.cssClass).asJQuery(),RadioRenderer(this).appendTo(this.fieldContainer)}},Radio.prototype=new FieldList,Select=function(t,i){this.init(t,i),this.renderOn=function(t){this.fieldContainer=t.div().addClass(this.cssClass).asJQuery(),SelectRenderer(this).appendTo(this.fieldContainer)}},Select.prototype=new FieldList,Condition=function(){this.label,this.init=function(t){void 0!==t&&(this.label=t)}},NotEmptyCondition=function(t){this.label="This field is required !",this.init(t),this.closure=function(t){return t.constructor===Array?t.length>0:""!=t}},NotEmptyCondition.prototype=new Condition,NumberCondition=function(t){this.label="This field must be a number !",this.init(t),this.closure=function(t){return!isNaN(t)}},NumberCondition.prototype=new Condition,EmailCondition=function(t){this.label="This field must be a valid email adress !",this.init(t),this.closure=function(t){return/\S+@\S+\.\S+/.test(t.toLowerCase())}},EmailCondition.prototype=new Condition,Error=function(t){var i=htmlCanvas.widget();return i.renderOn=function(i){i.span(t).addClass("error")},i};